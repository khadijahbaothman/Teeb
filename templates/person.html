{% extends 'base.html' %}
{% block title %}Ù…Ù„Ø®Øµ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ Ù„Ù„Ø­Ø§Ø¬{% endblock %}

{% block content %}
<section class="person-wrap">
  <div class="person-sheet card glass">

      <!-- Ø¹Ù†ÙˆØ§Ù† -->
      <h1 class="person-heading">Ù…Ù„Ø®Øµ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨ÙŠ </h1>

    <!-- Ø´Ø¹Ø§Ø± Ø·ÙŠØ¨ Ø§Ù„Ø£Ø¹Ù„Ù‰ (Ø¹Ø¯Ù‘Ù„ÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø¥Ù† Ù„Ø²Ù…) -->
    <div class="top-logo">
      <img src="{{ url_for('static', filename='logo33.png') }}" alt="Tayyeb" onerror="this.style.display='none'">
    </div>


    <!-- Ø´Ø§Ø±Ø© Ø±Ù‚Ù… Ù†Ø³Ùƒ (Ø¨ÙˆÙƒØ³) -->
    <div class="nusuk-box">Ø±Ù‚Ù… Ù†Ø³Ùƒ: {{ rec.get("Nusuk ID","â€”") }}</div>

    <!-- Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
    <div class="header-row persona">
      <!-- ÙŠØ³Ø§Ø±: Ø¹Ù„Ù… + Ø¬Ù†Ø³ÙŠØ© -->


      <!-- ÙˆØ³Ø·/ÙŠÙ…ÙŠÙ†: Ø§Ø³Ù… -->
      <div class="id-block">
        <div class="name">{{ rec.get("Full Name","â€”") }}</div>
      </div>
 <div class="left-flag">
        {% if flag_url %}
          <img class="flag" src="{{ flag_url }}" alt="flag" crossorigin="anonymous" referrerpolicy="no-referrer">
        {% else %}
          <div class="flag fallback">ğŸŒ</div>
        {% endif %}
        <div class="nat-label">{{ rec.get("Nationality","â€”") }}</div>
      </div>
    </div>

    <!-- Ø´Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø± ÙˆÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù… -->
    <div class="badges-row">
      <span class="pill pill-red">ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…: {{ rec.get("Blood Type","â€”") }}</span>
      <span class="pill pill-dark">Ø§Ù„Ø¹Ù…Ø±: {{ rec.get("Age","â€”") }}</span>
    </div>

    <hr class="soft-divider">

    <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ù…Ø®ÙÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø·ÙŠØ¨ ÙˆØ§Ù„ØªØ­Ù‚Ù‚) -->
 <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ù…Ø®ÙÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø·ÙŠØ¨ ÙˆØ§Ù„ØªØ­Ù‚Ù‚) -->
<div class="details-wrap">

  <!-- 1) Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
  <div class="section">
    <h3 class="sec-title strong">Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>

    {% if rec.get("Meds Photo") %}
      <!-- Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ ØµÙˆØ±Ø©: Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø³ØªØ© Ø§Ù„Ø«Ø§Ø¨ØªØ© -->
      <ul class="dot-list">
        <li>ğŸ’Š Glucophage (Ù…ÙŠØªÙÙˆØ±Ù…ÙŠÙ† 500 Ù…Ø¬Ù…)</li>
        <li>ğŸ’Š Aspirin Protect 100 (Ø£Ø³Ø¨Ø±ÙŠÙ† Ø¨Ø±ÙˆØªÙƒØª 100 Ù…Ø¬Ù…)</li>
        <li>ğŸ’Š Amlor (Ø£Ù…Ù„ÙˆØ± 5 Ù…Ø¬Ù…)</li>
      </ul>
    {% else %}
      <!-- Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©: Ù†Ø¹Ø±Ø¶ Ù…Ø§ Ø§Ø®ØªØ§Ø±Ù‡/ÙƒØªØ¨Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
      <ul class="dot-list">
        {% if rec.get("Current Meds") %}
          {% for line in rec.get("Current Meds","").splitlines() if line.strip() %}
            <li>{{ line.strip() }}</li>
          {% endfor %}
        {% else %}
          <li class="muted">â€”</li>
        {% endif %}
      </ul>
    {% endif %}
  </div>

  <!-- 2) Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø²Ù…Ù†Ø© -->
  <div class="section">
    <h3 class="sec-title strong">Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø²Ù…Ù†Ø©</h3>
    <div class="tag-list">
      {% set chronic_txt = (rec.get("Chronic Conditions","") or "").replace('\n','ØŒ') %}
      {% set has_any = false %}
      {% for item in chronic_txt.split("ØŒ") if item.strip() %}
        {% set has_any = true %}
        <span class="tag">{{ item.strip() }}</span>
      {% endfor %}
      {% if not has_any %}
        <span class="tag tag-empty">â€”</span>
      {% endif %}
    </div>
  </div>

  <!-- 3) ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙˆØ§Ø¡ (Ø§Ù„Ø£Ø®ÙŠØ±) -->
  {% if rec.get("Meds Photo") %}
    <div class="section">
      <h3 class="sec-title strong">ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙˆØ§Ø¡</h3>
      <img src="{{ url_for('uploaded_file', fname=rec['Meds Photo']) }}"
           alt="ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙˆØ§Ø¡" class="meds-img">
    </div>
  {% endif %}

</div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø£Ø³ÙÙ„ (Ø²Ø± Ø·ÙŠØ¨ + Ø·Ø¨Ø§Ø¹Ø©) -->
    <div class="sheet-actions">
      <button id="okBtn" class="btn btn-ok">ÙØ±ÙŠÙ‚ Ø·ÙÙŠØ¨</button>
      <button class="btn btn-dark" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>

  </div>
</section>

<!-- ===== Ø¨ÙˆØ¨-Ø£Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ + Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙØ§ØµÙŠÙ„ ===== -->
<script>
(function () {
  // Ø²Ø± "Ø·ÙŠØ¨" â†’ ÙŠÙØªØ­ Ø¨ÙˆØ¨-Ø£Ø¨ Ù„Ù„ØªØ­Ù‚Ù‚ Ø«Ù… ÙŠÙØ¸Ù‡Ø± Ø§Ù„ØªÙØ§ØµÙŠÙ„
  document.getElementById('okBtn')?.addEventListener('click', showPopup);

  function showPopup(){
    const overlay = document.createElement("div");
    overlay.style.cssText = `
      position:fixed; inset:0; background:rgba(0,0,0,.7);
      display:flex; align-items:center; justify-content:center; z-index:9999;
    `;
    overlay.innerHTML = `
      <div style="
        background:#fff; padding:30px; border-radius:20px;
        box-shadow:0 10px 40px rgba(0,0,0,.3); text-align:center;
        max-width:320px; width:90%; font-family:'Tajawal',sans-serif;
      ">
        <h2 style="margin-bottom:14px; font-size:20px;">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</h2>
        <p style="margin-bottom:16px; color:#444;">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
        <input type="password" id="idInput" placeholder="â€¢â€¢â€¢â€¢â€¢"
          style="width:100%; padding:10px; border:1px solid #ccc; border-radius:12px; text-align:center; font-size:16px;">
        <div id="errorMsg" style="color:#ef4444; margin-top:8px; display:none;">âŒ Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± ØµØ­ÙŠØ­</div>
        <button id="submitId"
          style="margin-top:16px; background:#0f766e; color:#fff; border:none; border-radius:12px; padding:10px 16px; font-weight:700; cursor:pointer;">
          ØªØ­Ù‚Ù‚
        </button>
      </div>
    `;
    document.body.appendChild(overlay);

    const correctCode = "99999";
    const doCheck = () => {
      const input = document.getElementById("idInput").value.trim();
      const error = document.getElementById("errorMsg");
      if (input === correctCode) {
        overlay.remove();
        const details = document.querySelector(".details-wrap");
        if (details){ details.style.display = "grid"; details.classList.add("reveal"); }
        document.getElementById('okBtn')?.remove();
      } else {
        error.style.display = "block";
        setTimeout(()=>{ error.style.display = "none"; }, 1600);
      }
    };
    document.getElementById("submitId").addEventListener("click", doCheck);
    document.getElementById("idInput").addEventListener("keyup", e => { if(e.key==="Enter") doCheck(); });
    document.getElementById("idInput").focus();
  }
})();
</script>

<style>
/* ===== Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø© ===== */
.person-wrap{ margin-top:10px; }
.person-heading{ text-align:center; font-size:28px; font-weight:900; margin:0 0 10px; color:#111827; }
.person-sheet{
  position:relative; background:#fff; border:1px solid var(--border, #e5e7eb);
  border-radius:28px; padding:24px 20px 20px; box-shadow:0 18px 40px rgba(0,0,0,.08); z-index:50;
}
.card.glass{ background:rgba(255,255,255,.75); backdrop-filter:blur(8px); border:1px solid rgba(255,255,255,.55); }

/* Ø´Ø¹Ø§Ø± Ø·ÙŠØ¨ Ø£Ø¹Ù„Ù‰ */
.top-logo{ display:flex; justify-content:center; margin-bottom:8px; }
.top-logo img{ height:48px; width:auto; }

/* Ø´Ø§Ø±Ø© Ø±Ù‚Ù… Ù†Ø³Ùƒ (Ø¨ÙˆÙƒØ³) */
.nusuk-box{
  position:absolute; left:22px; top:18px;
  background:#ecfeff; color:#0369a1; border:2px solid #34B8EC;
  border-radius:14px; padding:6px 16px; font-weight:800; font-size:16px;
  box-shadow:0 2px 6px rgba(3,105,161,.12); white-space:nowrap;
}
@media (max-width:640px){
  .nusuk-box{ position:relative; left:auto; top:auto; display:inline-block; margin:6px auto 4px; }
}

/* Ù‡ÙŠØ¯Ø± */
.header-row.persona{ display:grid; grid-template-columns: 1fr auto auto; gap:14px; align-items:center;  }
.flag{ width:52px; height:36px; object-fit:cover; border-radius:6px; border:1px solid #e5e7eb; }
.flag.fallback{ display:flex; align-items:center; justify-content:center; background:#f1f5f9; }
.nat-label{ font-weight:800; color:#111827; }
.id-block .name{ font-size:22px; font-weight:900; line-height:1.2; }
.avatar{ width:46px; height:46px; border-radius:50%; background:#f3f4f6; display:flex; align-items:center; justify-content:center; border:1px solid #e5e7eb; }
.avatar-icon{ font-size:22px; }

/* Ø¨Ø§Ø¯Ø¬Ø§Øª */
.badges-row{ display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 4px; }
.pill{ display:inline-block; padding:8px 16px; border-radius:999px; font-weight:800; font-size:16px; border:2px solid transparent; }
.pill-red{ background:#ffe4e6; color:#9f1239; border-color:#fecdd3; }
.pill-dark{ background:#0f172a; color:#fff; border-color:#0f172a; }

/* Ø£Ù‚Ø³Ø§Ù… */
.sec-title{ font-size:20px; font-weight:900; margin:0 0 8px; color:#111827; }
.sec-title.strong{ font-size:26px; }
.sub-sec{ margin:10px 0 6px; font-weight:800; }

.tag-list{ display:flex; flex-wrap:wrap; gap:8px; }
.tag{ background:#ecfeff; color:#0369a1; border:1.5px solid #67e8f9; padding:6px 12px; border-radius:999px; font-weight:800; font-size:14px; }
.tag-empty{ background:#f3f4f6; border-color:#e5e7eb; color:#6b7280; }

.dot-list{ margin:0; padding-inline-start:1.2rem; }
.dot-list li{ margin:6px 0; }
.mt6{ margin-top:6px; }

/* ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙˆØ§Ø¡ */
.meds-img{ width:220px; max-width:100%; border-radius:12px; border:1px solid #e5e7eb; }

/* Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
.details-wrap{ display:none; grid-template-columns: 1fr; gap:18px; }
.details-wrap.reveal{ animation: fadeIn .25s ease-in; }
@keyframes fadeIn{ from{opacity:.4} to{opacity:1} }

/* Ø£Ø²Ø±Ø§Ø± Ø£Ø³ÙÙ„ */
.sheet-actions{ display:flex; gap:12px; justify-content:flex-end; margin-top:16px; }
.btn{ border-radius:16px; padding:10px 16px; font-weight:900; border:1px solid transparent; cursor:pointer; }
.btn-dark{ background:#111827; color:#fff; }
.btn-dark:hover{ background:#0b1220; }
.btn-ok{ background:#34B8EC; color:#fff; border:1px solid #34B8EC; box-shadow:0 6px 16px rgba(52,184,236,.28); }
.btn-ok:hover{ background:#1fa7df; border-color:#1fa7df; }

/* Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media (max-width:640px){
  .header-row.persona{ grid-template-columns: 1fr auto; }
  .avatar{ grid-column:2/3; }
  .id-block .name{ font-size:20px; }
  .sec-title.strong{ font-size:22px; }
}
</style>
{% endblock %}