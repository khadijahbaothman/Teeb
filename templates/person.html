{% extends 'base.html' %}
{% block title %}Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®Øµ{% endblock %}
{% block content %}
<section class="card person-card glass">

  <!-- Ù‡ÙŠØ¯Ø± Ù…Ù†Ø³Ù‘Ù‚ -->
  <div class="person-header">
    <div class="person-main">
      <div class="person-name">{{ rec.get("Full Name","â€”") }}</div>
      <div class="person-sub">
        {{ rec.get("Age","â€”") }}â€¢ {{ rec.get("Nationality","â€”") }}
      </div>
      <div class="person-phone">
        {{ rec.get("Phone","â€”") }}
      </div>
    </div>

    {% if rec.get("Nusuk ID") %}
    <div class="id-badge">
      <span>Ø±Ù‚Ù… Ù†Ø³Ùƒ:</span>
      <strong>{{ rec["Nusuk ID"] }}</strong>
    </div>
    {% endif %}
  </div>


  <!-- Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø²Ù…Ù†Ø© -->
  <div class="info-section">
    <h3>ğŸ©º Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø²Ù…Ù†Ø©</h3>
    <div class="tag-list">
      {% set chronic_str = rec.get("Chronic Conditions","") %}
      {% for raw in chronic_str.split("ØŒ") if raw.strip() %}
        {% set item = raw.strip() %}
        {% if item.startswith("Ø£Ø®Ø±Ù‰") %}
          {% set parts = item.split(":", 1) %}
          {% set val = parts[1].strip() if parts|length > 1 else "Ø£Ø®Ø±Ù‰" %}
          <span class="tag">{{ val }}</span>
        {% else %}
          <span class="tag">{{ item }}</span>
        {% endif %}
      {% endfor %}
      {% if not chronic_str.strip() %}<span class="tag tag-empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>{% endif %}
    </div>
  </div>

  <!-- Ø§Ù„Ø­Ø³Ø§Ø³ÙŠÙ‘Ø§Øª -->
  <div class="info-section">
    <h3>ğŸŒ¿ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠÙ‘Ø§Øª</h3>
    <div class="tag-list">
      {% set allergies_str = rec.get("Allergies","") %}
      {% for raw in allergies_str.split("ØŒ") if raw.strip() %}
        {% set item = raw.strip() %}
        {% if item.startswith("Ø£Ø®Ø±Ù‰") %}
          {% set parts = item.split(":", 1) %}
          {% set val = parts[1].strip() if parts|length > 1 else "Ø£Ø®Ø±Ù‰" %}
          <span class="tag">{{ val }}</span>
        {% else %}
          <span class="tag">{{ item }}</span>
        {% endif %}
      {% endfor %}
      {% if not allergies_str.strip() %}<span class="tag tag-empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>{% endif %}
    </div>
  </div>

  <!-- Ø§Ù„Ø£Ø¯ÙˆÙŠØ© / Ø§Ù„ØªØ·Ø¹ÙŠÙ…Ø§Øª -->
  <div class="info-section">
    <h3>ğŸ’Š Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
    <p class="plain">{{ rec.get("Current Meds","â€”") or "â€”" }}</p>
  </div>

  <div class="info-section">
    <h3>ğŸ’‰ Ø§Ù„ØªØ·Ø¹ÙŠÙ…Ø§Øª</h3>
    <p class="plain">{{ rec.get("Vaccinations","â€”") or "â€”" }}</p>
  </div>
  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
  <div class="person-actions">
    <button type="button" class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙØ­Ø©</button>
    <button type="button" class="btn-danger" id="panicBtn">ğŸš¨ Ø·ÙˆØ§Ø±Ø¦</button>
  </div>
</section>


<script>
  // Ø­Ø§Ù„ÙŠØ§Ù‹ Ø²Ø± Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø¨Ø¯ÙˆÙ† ÙØ¹Ù„ â€” Ø¨Ù†Ø±Ø¨Ø·Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
  document.getElementById('panicBtn')?.addEventListener('click', () => {
    alert('Ø²Ø± Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø¬Ø§Ù‡Ø² â€“ Ù‚ÙˆÙ„ÙŠ Ù„ÙŠ ÙˆØ´ ØªØ¨ÙŠÙ† ÙŠØ³ÙˆÙŠ Ø¨Ø§Ù„Ø¶Ø¨Ø· (Ø§ØªØµØ§Ù„/ÙØªØ­ Ø´Ø§Ø´Ø©/Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡).');
  });
</script>
{% endblock %}