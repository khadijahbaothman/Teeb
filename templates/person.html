{% extends 'base.html' %}
{% block title %}بيانات الشخص{% endblock %}
{% block content %}
<section class="card person-card glass">

  <!-- هيدر منسّق -->
  <div class="person-header">
    <div class="person-main">
      <div class="person-name">{{ rec.get("Full Name","—") }}</div>
      <div class="person-sub">
        {{ rec.get("Age","—") }}• {{ rec.get("Nationality","—") }}
      </div>
      <div class="person-phone">
        {{ rec.get("Phone","—") }}
      </div>
    </div>

    {% if rec.get("Nusuk ID") %}
    <div class="id-badge">
      <span>رقم نسك:</span>
      <strong>{{ rec["Nusuk ID"] }}</strong>
    </div>
    {% endif %}
  </div>


  <!-- الأمراض المزمنة -->
  <div class="info-section">
    <h3>🩺 الأمراض المزمنة</h3>
    <div class="tag-list">
      {% set chronic_str = rec.get("Chronic Conditions","") %}
      {% for raw in chronic_str.split("،") if raw.strip() %}
        {% set item = raw.strip() %}
        {% if item.startswith("أخرى") %}
          {% set parts = item.split(":", 1) %}
          {% set val = parts[1].strip() if parts|length > 1 else "أخرى" %}
          <span class="tag">{{ val }}</span>
        {% else %}
          <span class="tag">{{ item }}</span>
        {% endif %}
      {% endfor %}
      {% if not chronic_str.strip() %}<span class="tag tag-empty">لا يوجد</span>{% endif %}
    </div>
  </div>

  <!-- الحساسيّات -->
  <div class="info-section">
    <h3>🌿 الحساسيّات</h3>
    <div class="tag-list">
      {% set allergies_str = rec.get("Allergies","") %}
      {% for raw in allergies_str.split("،") if raw.strip() %}
        {% set item = raw.strip() %}
        {% if item.startswith("أخرى") %}
          {% set parts = item.split(":", 1) %}
          {% set val = parts[1].strip() if parts|length > 1 else "أخرى" %}
          <span class="tag">{{ val }}</span>
        {% else %}
          <span class="tag">{{ item }}</span>
        {% endif %}
      {% endfor %}
      {% if not allergies_str.strip() %}<span class="tag tag-empty">لا يوجد</span>{% endif %}
    </div>
  </div>

  <!-- الأدوية / التطعيمات -->
  <div class="info-section">
    <h3>💊 الأدوية الحالية</h3>
    <p class="plain">{{ rec.get("Current Meds","—") or "—" }}</p>
  </div>

  <div class="info-section">
    <h3>💉 التطعيمات</h3>
    <p class="plain">{{ rec.get("Vaccinations","—") or "—" }}</p>
  </div>
  <!-- أزرار الإجراءات -->
  <div class="person-actions">
    <button type="button" class="btn btn-print" onclick="window.print()">🖨️ طباعة الصفحة</button>
    <button type="button" class="btn-danger" id="panicBtn">🚨 طوارئ</button>
  </div>
</section>


<script>
  // حالياً زر الطوارئ بدون فعل — بنربطه لاحقاً
  document.getElementById('panicBtn')?.addEventListener('click', () => {
    alert('زر الطوارئ جاهز – قولي لي وش تبين يسوي بالضبط (اتصال/فتح شاشة/إرسال تنبيه).');
  });
</script>
{% endblock %}